{"version":3,"sources":["scripts/main.js"],"names":["this","MyOD","Backbone","Marionette","Application","on","searchModel","Models","SearchModel","layout","Main","Layout","history","start","pushState","root","navigate","trigger","setClasses","route","options","search","getRoute","navigate404","replace","queryStringToObject","result","q","getFragment","split","pairs","_","each","pair","decodeURIComponent","getBloodhound","bloodhound","Bloodhound","datumTokenizer","tokenizers","obj","whitespace","queryTokenizer","limit","remote","url","config","api","rateLimitWait","query","filter","response","data","onBeforeDestroy","stop","module","Utils","App","$","MapManager","Object","extend","initialize","bindAll","globalChannel","Wreqr","radio","channel","_loadDojo","reqres","setHandler","updateStyle","dfd","Deferred","dojoReady","promise","window","dojo","resolve","include","require","map","destroy","proxyEvent","evtName","evt","vent","createMap","mapDiv","self","mapOpts","center","zoom","basemap","smartNavigation","navigationMode","fitExtent","minZoom","wrapAround180","esri","Map","onLoad","opts","disableScrollWheelZoom","coords","extent","geometry","Extent","SpatialReference","wkid","setExtent","hitch","getDatasetInfoTemplate","dataset","displayFieldName","get","InfoTemplate","getDatasetLayerOpts","mode","layers","FeatureLayer","MODE_AUTO","outFields","infoTemplate","addDataset","datasetLayer","onLoadDataset","addLayer","layer","minScale","maxScale","_applyRenderer","smap","setRenderer","renderer","graphics","length","attributes","field","redraw","refresh","type","smartMapping","createClassedColorRenderer","then","heatmap","createHeatmapRenderer","createClassedSizeRenderer","Base","SearchView","ItemView","onRender","initTypeahead","highlight","minLength","hint","datasets","name","displayKey","item","templates","empty","source","ttAdapter","ui","typeahead","onTypeaheadSelected","model","set","page","updateModel","onKeyDown","e","which","preventDefault","onKeyUp","Model","defaults","per_page","total_count","sort_by","queryStringParams","pick","toJSON","param","getUrl","JST","datasets/templates/dataset","__t","__p","escape","moment","created_at","calendar","updated_at","tags","join","datasets/templates/table-row","Array","prototype","fields","datasets/templates/table","from","toLocaleString","to","total","sortField","alias","pages","error/templates/404","error/templates/500","home/templates/home","results/templates/results-empty","results/templates/results-item","fromNow","results/templates/results-loading","results/templates/results","collectionIsLoading","HeaderSearchView","listenTo","onQueryChanged","el","template","events","keydown #header-search","keyup #header-search","click #header-search-btn","typeahead:selected input","LayoutView","headerSearchView","render","regions","main","click #home-link","navigateHome","metaKey","ctrlKey","indexOf","$el","removeClass","addClass","HomeModule","View","keydown #search","keyup #search","click #search-btn","id","onDomRefresh","focus","Controller","initUi","view","getRegion","show","Router","AppRouter","appRoutes","addInitializer","controller","API","homeController","DatasetModel","onSync","description","arcgis_online_item_url","owner","views","thumbnail_url","parse","getNumericFields","contains","DatasetCollection","Collection","resp","metadata","query_parameters","stats","ResultsModule","tagName","click","onClick","LoadingView","className","EmptyView","CompositeView","selectDataset","childView","childViewContainer","getEmptyView","click ul.pagination a","modelEvents","change:total_count","collectionEvents","sync","error","onCollectionSync","childModel","onPageClicked","stopPropagation","target","closest","templateHelpers","active","info","len","Math","round","size","total_pages","ceil","end","clone","i","push","prevUrl","prevPage","nextUrl","nextPage","firstPage","lastPage","collection","fetch","cache","datasets(/)","queryObj","resultsController","DatasetRow","RowCollection","queryCapabilities","supportsPagination","supports_pagination","orderBy","perPage","orderByAsc","getQueryUrl","rows","features","first","DatasetsModule","TableRowView","TableView","click ul.pagination li a","click thead th","reset","childViewOptions","showPagination","sortClass","sortIconClass","totalPages","anchor","li","hasClass","sort","mapManager","tableContainer","change","baseUrl","tableView","toLowerCase","done","coordinates","initSmaps","numerics","fieldName","getStats","getGeometryType","yukiOptions","statistics","schemes","getSchemes","yuki","remove","Yuki","changeAttribute","changeRamp","_execStyleMap","fieldObj","findWhere","geomType","theme","styleType","styles","geometryType","selectedScheme","index","secondarySchemes","scheme","request","buildPointLegend","breaks","onDestroy","onModelFetched","fail","datasets/:id(/)","datasetsController","ErrorModule","getTemplate","errorCode","404","500","initController","errorController","error404","error500"],"mappings":"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","file":"scripts/main.js","sourcesContent":["/*jshint -W020 */\n\nif (!this.MyOD || typeof this.MyOD !== 'object') {\n  this.MyOD = {};\n}\n\n(function () {\n  'use strict';\n\n  MyOD = new Backbone.Marionette.Application();\n\n  MyOD.on('before:start', function(options){\n    this.searchModel = new MyOD.Models.SearchModel();\n    this.layout = new MyOD.Main.Layout();\n    //this.reqres = new Backbone.Wreqr.RequestResponse();\n  });\n\n  MyOD.on('start', function(options){\n    if (Backbone.history){\n      //if you are hosting on a server that can let the browser handle all the routing,\n      //you can use pushstate, otherwise (gh-pages) use hashed urls\n      //Backbone.history.start({ pushState: Modernizr.history, root: '/OpenData-Backbone' });\n      if (!Backbone.history.start({ pushState: false, root: '/OpenData-Backbone' })) {\n        MyOD.navigate('404', { trigger:true });\n      }\n    }\n\n    Backbone.history.on('route', this.layout.setClasses);\n    this.layout.setClasses();\n  });\n\n  MyOD.navigate = function (route, options) {\n    Backbone.history.navigate(route, options);\n  };\n\n  MyOD.search = function (options) {\n    var route = MyOD.searchModel.getRoute();\n    MyOD.navigate(route, { trigger:true });\n  };\n\n  MyOD.navigate404 = function () {\n    MyOD.navigate('404', { trigger: true, replace: true });\n  };\n\n  MyOD.queryStringToObject = function () {\n    var result = {};\n\n    var q = Backbone.history.getFragment().split('?')[1];\n\n    if (q) {\n      var pairs = q.split('&');\n      \n      _.each(pairs, function(pair) {\n        pair = pair.split('=');\n        if (pair[0] === 'q') {\n          result[pair[0]] = pair[1].replace(/\\+/g, ' ') || '';\n        } else {\n          result[pair[0]] = decodeURIComponent(pair[1] || '');\n        }\n      });\n    }\n\n    return result;\n  };\n\n  MyOD.getBloodhound = function () {\n    if (!this.bloodhound) {\n      this.bloodhound = new Bloodhound({\n        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\n        queryTokenizer: Bloodhound.tokenizers.whitespace,\n        limit: 10,\n        remote: {\n          url: MyOD.config.api + 'datasets/autocomplete.json?query=%QUERY',\n          rateLimitWait: 150,\n          replace: function (url, query) {\n            return url.replace('%QUERY', query);\n          },\n          filter: function(response) {\n            return response.data;\n          }\n        }\n      });\n    }\n    return this.bloodhound;\n  };\n\n  MyOD.onBeforeDestroy = function () {\n    Backbone.history.stop();\n  };\n\n})();\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('Utils', function (Utils, App, Backbone, Marionette, $, _) {\n\n    Utils.MapManager = Marionette.Object.extend({\n      \n      initialize: function () {\n        _.bindAll(this, 'updateStyle');\n\n        this.globalChannel = Backbone.Wreqr.radio.channel('global');\n        //load dojo and start the map\n        this._loadDojo();\n        App.reqres.setHandler('smaps:update:style', this.updateStyle);\n\n      },\n\n      /**\n       * load dojo, resolve a promise when it's ready to roll\n       */\n      _loadDojo: function(){\n        var dfd = $.Deferred();\n        this.dojoReady = dfd.promise();\n        //check if dojo is loaded...\n        if( !window.dojo ){\n          //if not, inject a script tag, and then require in things\n          include('//js.arcgis.com/3.13compact/init.js', function(){\n            //now that require is present, load in the other things we need\n            require(['esri/map', 'esri/layers/FeatureLayer', 'plugins/smartMapping', 'dojo/domReady!'], function(Map) {\n              dfd.resolve();\n            });\n          }); \n\n        }else{\n          //it's loaded\n          dfd.resolve();\n        }\n      },\n\n\n      onBeforeDestroy: function () {\n        if (this.map) {\n          this.map.destroy();\n        }\n      },\n\n      proxyEvent: function (evtName, evt) {\n        this.globalChannel.vent.trigger(evtName, evt);\n        //OR (if everything that will listen has a reference to this)\n        //this.trigger(evtName, evt);\n      },\n\n      createMap: function (mapDiv, options) {\n        var self = this;\n        var mapOpts = {\n          center: [ -56.049, 38.485 ],\n          zoom: 3,\n          basemap: 'dark-gray',\n          smartNavigation:false,\n          navigationMode: 'css-transforms',\n          fitExtent:true,\n          minZoom: 2,\n          wrapAround180:true\n        };\n\n        this.map = new esri.Map(mapDiv, mapOpts);\n        \n       \n        var onLoad = function(opts){\n            opts.map.disableScrollWheelZoom();\n            if (options.coords) {\n              var extent = new esri.geometry.Extent(options.coords[0][0], options.coords[0][1], options.coords[1][0], options.coords[1][1], new esri.SpatialReference({ wkid: 4326 }));\n              opts.map.setExtent(extent);\n            }\n            self.proxyEvent('map:load');\n        };\n\n        //proxy events\n        this.map.on('load', dojo.hitch(this, onLoad));\n        this.map.on('extent-change', dojo.hitch(this, this.proxyEvent, 'map:extent-change'));\n        this.map.on('layer-add', dojo.hitch(this, this.proxyEvent, 'map:layer-add'));\n      },\n\n\n\n\n      getDatasetInfoTemplate: function (dataset) {\n        //var datasetName = dataset.get('name');\n        var displayFieldName = dataset.get('display_field');\n        return new esri.InfoTemplate('${' + displayFieldName + '}', '${*}');\n      },\n\n      getDatasetLayerOpts: function (dataset) {\n        return { \n          mode: esri.layers.FeatureLayer.MODE_AUTO,\n          outFields: '*',\n          infoTemplate: this.getDatasetInfoTemplate(dataset)\n        };\n      },\n\n      addDataset: function (dataset) {\n        var opts = this.getDatasetLayerOpts(dataset);\n        this.datasetLayer = new esri.layers.FeatureLayer(dataset.get('url'), opts);\n\n        this.datasetLayer.on('load', this.onLoadDataset);\n\n        //proxy events\n        this.datasetLayer.on('load', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:load'));\n        this.datasetLayer.on('click', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:click'));\n        this.datasetLayer.on('query-limit-exceeded', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:query-limit-exceeded'));\n        this.datasetLayer.on('update-end', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:update-end'));\n\n        this.map.addLayer(this.datasetLayer);\n      },\n\n      onLoadDataset: function (evt) {\n        //squash scale ranges - we need the layer to draw at all scales\n        evt.layer.minScale = 0; \n        evt.layer.maxScale = 0;\n      },\n\n      updateStyle: function (opts) {\n        var dfd = $.Deferred();\n\n        var layer = opts.layer = this.datasetLayer;\n\n        var _applyRenderer = function(smap){\n          layer.setRenderer(smap.renderer);\n\n          //check if refresh needed, else redraw\n          if ( layer.graphics && layer.graphics.length ) {\n            if (layer.graphics[0].attributes[ opts.field ]) {\n              layer.redraw();\n            } else {\n              layer.refresh();\n            }\n          }\n\n          dfd.resolve(smap.renderer);\n        };\n\n          \n        if (opts.type === 'polygon'){\n          esri.renderer.smartMapping.createClassedColorRenderer(opts)\n            .then(function(renderer){\n              _applyRenderer( renderer );\n            });\n        } else if (opts.type === 'point' && !opts.heatmap){\n          esri.renderer.smartMapping.createClassedSizeRenderer(opts)\n            .then(function(renderer){\n              _applyRenderer( renderer );\n            });\n        } else if (opts.type === 'point' && opts.heatmap) {\n          esri.renderer.smartMapping.createHeatmapRenderer(opts)\n            .then(function(renderer){\n              _applyRenderer( renderer );\n            });\n        }\n\n        return dfd.promise();\n      }\n      \n    });\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Base', function (Base, App, Backbone, Marionette, $, _) {\n\n    Base.SearchView = Marionette.ItemView.extend({ \n\n      onRender: function(){\n        this.initTypeahead();\n      },\n\n      initTypeahead: function () {\n        var self = this;\n\n        var opts = {\n          highlight: true,\n          minLength: 3,\n          hint: false\n        };\n\n        var bloodhound = App.getBloodhound();\n        bloodhound.initialize();\n\n        var datasets = {\n          name: 'datasets',\n          displayKey: function(item) {\n            return item;\n          },\n          templates: {\n            empty: ''\n          },\n          source: bloodhound.ttAdapter()\n        };\n\n        this.ui.search.typeahead(opts, datasets);\n      },\n\n      onTypeaheadSelected: function (e) {\n        //clicking a selection with the mouse should initiate a search  \n        this.model.set({\n          q: this.ui.search.typeahead('val'),\n          page: 1\n        });\n\n        this.search();\n      },\n\n      updateModel: function () {\n        var q = this.ui.search.typeahead('val');\n        this.model.set({\n          q: q,\n          page: 1\n        });\n      },\n\n      onKeyDown:function(e){\n        if (e.which === 13) {\n          e.preventDefault();\n\n          this.updateModel();\n\n          this.search();\n        }\n      },\n\n      onKeyUp: function () {\n        this.updateModel();\n      },\n\n      search: function () {\n        App.search();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.SearchModel = Backbone.Model.extend({ \n\n      defaults: {\n        q: '',\n        page: 1,\n        per_page: 20,\n        total_count: 0,\n        sort_by: 'relevance'\n      },\n\n      queryStringParams: [ 'q', 'page', 'per_page', 'sort_by' ],\n\n      getRoute: function (api) {\n        var obj = _.pick(this.toJSON(), this.queryStringParams);\n        var route = 'datasets';\n        route += (api) ? '.json?' : '?';\n        route += $.param(obj);\n        return route;\n      },\n\n      getUrl: function () {\n        return App.config.api + this.getRoute(true);\n      }\n\n    });\n\n  });\n\n})();\n\nMyOD.config = {\n  //api: '//umb.dcdev.opendata.arcgis.com/'\n  //api: '//data3.dc.opendataqa.arcgis.com/'\n  //api: '//umb.dcdev.staging.datacommunity.io/'\n  api: '//opendata.arcgis.com/'\n};\nthis.JST = {\"datasets/templates/dataset\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"clearfix\">\\n  <h2 class=\"pull-left clearfix\"><img class=\"img-thumbnail\" src=\"' +\n((__t = ( thumbnail_url )) == null ? '' : __t) +\n'\"><span>' +\n((__t = ( name )) == null ? '' : __t) +\n'</span></h2>\\n  <div class=\"dropdown pull-right\">\\n    <button class=\"btn btn-primary\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\\n      Download\\n      <span class=\"caret\"></span>\\n    </button>\\n    <ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.csv\" target=\"_blank\" download>Spreadsheet</a></li>\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.kml\" target=\"_blank\" download>KML</a></li>\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.zip\" target=\"_blank\" download>Shapefile</a></li>\\n      <li class=\"divider\"></li>\\n      <li><a href=\"' +\n((__t = ( arcgis_online_item_url )) == null ? '' : __t) +\n'\" target=\"_blank\">View in ArcGIS Online</a></li>\\n      <li><a href=\"' +\n((__t = ( url )) == null ? '' : __t) +\n'\" target=\"_blank\">API</a></li>\\n    </ul>\\n  </div>\\n</div>\\n\\n\\n<dl class=\"dl-horizontal\">\\n  \\n  <dt>Description:</dt>\\n  <dd>' +\n((__t = ( description )) == null ? '' : __t) +\n'</dd>\\n  \\n  <dt>Owner:</dt>\\n  <dd>' +\n((__t = ( owner )) == null ? '' : __t) +\n'</dd>\\n\\n  <dt>Created:</dt>\\n  <dd>' +\n((__t = ( moment(created_at).calendar() )) == null ? '' : __t) +\n'</dd>\\n  \\n  <dt>Updated:</dt>\\n  <dd>' +\n((__t = ( moment(updated_at).calendar() )) == null ? '' : __t) +\n'</dd>\\n\\n  <dt>Tags:</dt>\\n  <dd>' +\n((__t = ( tags.join(' | ') )) == null ? '' : __t) +\n'</dd>\\n  \\n  <dt>Views:</dt>\\n  <dd>' +\n((__t = ( views )) == null ? '' : __t) +\n'</dd>\\n\\n</dl>\\n\\n<div class=\"container\">\\n  <div id=\"map\"></div>\\n  <div id=\"smaps\">\\n    <div class=\"container\"></div>\\n  </div>\\n</div>\\n\\n<div id=\"table-container\" class=\"container\"></div>\\n';\n\n}\nreturn __p\n},\n\"datasets/templates/table-row\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n\n _.each(fields, function (field) { ;\n__p += '\\n  <td>' +\n((__t = ( attributes[field.name] )) == null ? '' : __t) +\n'</td>\\n';\n }); ;\n__p += '\\n';\n\n}\nreturn __p\n},\n\"datasets/templates/table\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h4>Showing ' +\n((__t = ( from.toLocaleString() )) == null ? '' : __t) +\n' to ' +\n((__t = ( to.toLocaleString() )) == null ? '' : __t) +\n' of ' +\n((__t = ( total.toLocaleString() )) == null ? '' : __t) +\n'</h4>\\n<div class=\"table-responsive\">  \\n  <table class=\"table table-striped table-bordered table-hover\">\\n    <thead>\\n      <tr>\\n        ';\n _.each(fields, function (field) { ;\n__p += '\\n          ';\n if (sortField === field.name) { ;\n__p += '\\n            <th data-field-name=\"' +\n((__t = ( field.name )) == null ? '' : __t) +\n'\" class=\"' +\n((__t = ( sortClass )) == null ? '' : __t) +\n'\">\\n              ' +\n((__t = ( field.alias || field.name )) == null ? '' : __t) +\n'\\n              <span class=\"glyphicon small ' +\n((__t = ( sortIconClass )) == null ? '' : __t) +\n' text-muted\" aria-hidden=\"true\"></span>\\n            </th>\\n          ';\n } else { ;\n__p += '\\n            <th data-field-name=\"' +\n((__t = ( field.name )) == null ? '' : __t) +\n'\">\\n              ' +\n((__t = ( field.alias || field.name )) == null ? '' : __t) +\n'\\n            </th>\\n          ';\n } ;\n__p += '\\n        ';\n }); ;\n__p += '\\n      </tr>\\n    </thead>\\n    <tbody></tbody>\\n  </table>\\n</div>\\n<nav>\\n  <ul class=\"pagination\">\\n    ';\n if (pages.length > 1) { ;\n__p += '\\n      <li id=\"page-prev\" class=\"' +\n((__t = ( firstPage )) == null ? '' : __t) +\n'\"><a data-page=\"' +\n((__t = ( prevPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&laquo;</span></a></li>\\n      \\n      ';\n _.each(pages, function (page) { ;\n__p += '\\n        <li class=\"' +\n((__t = ( page.active )) == null ? '' : __t) +\n'\"><a class=\"page-number\" data-page=\"' +\n((__t = ( page.page )) == null ? '' : __t) +\n'\">' +\n((__t = ( page.page )) == null ? '' : __t) +\n'</a></li>\\n      ';\n }); ;\n__p += '\\n\\n      <li id=\"page-next\" class=\"' +\n((__t = ( lastPage )) == null ? '' : __t) +\n'\"><a data-page=\"' +\n((__t = ( nextPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&raquo;</span></a></li>\\n    ';\n } ;\n__p += '\\n  </ul>\\n</nav>';\n\n}\nreturn __p\n},\n\"error/templates/404\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"alert alert-danger\" role=\"alert\">\\n  <h2>The page you are looking for doesn\\'t exist.</h2>\\n</div>\\n';\n\n}\nreturn __p\n},\n\"error/templates/500\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"alert alert-danger\" role=\"alert\">\\n  <h2>An error ocurred.</h2>\\n</div>\\n';\n\n}\nreturn __p\n},\n\"home/templates/home\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"jumbotron\" id=\"hero\">\\n  <h1 class=\"page-header\">My Open Data</h1>\\n\\n\\n  <p>\\n    <div class=\"input-group input-group-lg\">\\n      <label class=\"sr-only\" for=\"search\">Search</label>\\n      <input type=\"search\" name=\"search\" id=\"search\" class=\"form-control\" placeholder=\"search for open data\">\\n      <span class=\"input-group-btn\">\\n        <button id=\"search-btn\" class=\"btn btn-default\" type=\"button\">\\n          <span class=\"glyphicon glyphicon-search\" aria-hidden=\"true\"></span>\\n        </button>\\n      </span>\\n    </div>\\n  </p>\\n\\n</div>\\n';\n\n}\nreturn __p\n},\n\"results/templates/results-empty\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td colspan=\"7\" class=\"text-center\">...</td>';\n\n}\nreturn __p\n},\n\"results/templates/results-item\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td>' +\n((__t = ( name )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( owner )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( record_count )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( layer_type )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( views )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( moment(created_at).fromNow() )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( moment(updated_at).fromNow() )) == null ? '' : __t) +\n'</td>';\n\n}\nreturn __p\n},\n\"results/templates/results-loading\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td colspan=\"7\" class=\"text-center\">\\n  <div class=\"progress\">\\n    <div class=\"progress-bar progress-bar-striped active\" role=\"progressbar\" aria-valuenow=\"40\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 45%\">\\n      <span class=\"sr-only\">45% Complete</span>\\n    </div>\\n  </div>\\n</td>';\n\n}\nreturn __p\n},\n\"results/templates/results\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n  ';\n if (!collectionIsLoading) { ;\n__p += '\\n    Your search for <em>\"' +\n((__t = ( q )) == null ? '' : __t) +\n'\"</em> yielded ' +\n((__t = ( total_count.toLocaleString() )) == null ? '' : __t) +\n' datasets\\n  ';\n } ;\n__p += '\\n</h2>\\n\\n<div class=\"table-responsive\">  \\n  <table class=\"table table-striped table-bordered table-hover\">\\n    <thead>\\n      <tr>\\n        <th>NAME</th>\\n        <th>OWNER</th>\\n        <th>RECORDS</th>\\n        <th>LAYER TYPE</th>\\n        <th>VIEWS</th>\\n        <th>CREATED</th>\\n        <th>UPDATED</th>\\n      </tr>\\n    </thead>\\n    <tbody></tbody>\\n  </table>\\n</div>\\n<nav>\\n  <ul class=\"pagination\">\\n    ';\n if (pages.length > 1) { ;\n__p += '\\n      <li id=\"page-prev\" class=\"' +\n((__t = ( firstPage )) == null ? '' : __t) +\n'\"><a href=\"' +\n((__t = ( prevUrl )) == null ? '' : __t) +\n'\" data-page=\"' +\n((__t = ( prevPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&laquo;</span></a></li>\\n      \\n      ';\n _.each(pages, function (page) { ;\n__p += '\\n        <li class=\"' +\n((__t = ( page.active )) == null ? '' : __t) +\n'\"><a href=\"' +\n((__t = ( page.url )) == null ? '' : __t) +\n'\" class=\"page-number\" data-page=\"' +\n((__t = ( page.page )) == null ? '' : __t) +\n'\">' +\n((__t = ( page.page )) == null ? '' : __t) +\n'</a></li>\\n      ';\n }); ;\n__p += '\\n\\n      <li id=\"page-next\" class=\"' +\n((__t = ( lastPage )) == null ? '' : __t) +\n'\"><a href=\"' +\n((__t = ( nextUrl )) == null ? '' : __t) +\n'\" data-page=\"' +\n((__t = ( nextPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&raquo;</span></a></li>\\n    ';\n } ;\n__p += '\\n  </ul>\\n</nav>';\n\n}\nreturn __p\n}};\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Main', function (Main, App, Backbone, Marionette, $, _) {\n          \n    Main.HeaderSearchView = MyOD.Base.SearchView.extend({ \n\n      initialize: function () {\n        this.listenTo(this.model, 'change:q', this.onQueryChanged);\n      },\n\n      el: '#header-search-container',\n\n      template: false,\n\n      events: {\n        'keydown #header-search': 'onKeyDown',\n        'keyup #header-search': 'onKeyUp',\n        'click #header-search-btn': 'search',\n        'typeahead:selected input': 'onTypeaheadSelected'\n      },\n\n      ui: {\n        search: '#header-search'\n      },\n\n      onQueryChanged: function () {\n        this.ui.search.typeahead('val', this.model.get('q'));\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Main', function (Main, App, Backbone, Marionette, $, _) {\n\n    Main.Layout = Marionette.LayoutView.extend({\n      \n      initialize: function () {\n        _.bindAll(this, 'setClasses');\n        this.headerSearchView = new Main.HeaderSearchView({ model: App.searchModel }).render();\n      },\n\n      el: 'body',\n\n      regions: {\n        main: '#main-region'\n      },\n\n      events: {\n        'click #home-link': 'navigateHome'\n      },\n\n      navigateHome: function (e) {\n        if (!e.metaKey && !e.ctrlKey) {\n          e.preventDefault();\n          App.navigate('', { trigger: true });\n        }\n      },\n\n      setClasses: function () {\n        var self = this;\n        if (Backbone.history.getFragment().indexOf('datasets') === 0) {\n          self.$el.removeClass('page-home');\n        } else {\n          self.$el.addClass('page-home');\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n          \n    HomeModule.View = MyOD.Base.SearchView.extend({ \n\n      initialize: function () {\n        this.model = App.searchModel;   \n      },\n\n      template: JST['home/templates/home'],\n\n      events: {\n        'keydown #search': 'onKeyDown',\n        'keyup #search': 'onKeyUp',\n        'click #search-btn': 'search',\n        'typeahead:selected input': 'onTypeaheadSelected'\n      },\n\n      ui: {\n        search: '#search'\n      },\n\n      id: 'home',\n\n      onDomRefresh: function () {\n        this.ui.search.focus();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n          \n    HomeModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function () {\n        var view = new HomeModule.View();\n        App.layout.getRegion('main').show(view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    HomeModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        '': 'show'\n      }\n    });\n\n    //Add the router during the initialization \n    HomeModule.addInitializer(function (options) {\n      var router = new HomeModule.Router({ controller: HomeModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    HomeModule.API = {\n\n      show: function(options){\n\n        if(!this.homeController){\n          this.homeController = new HomeModule.Controller(options);\n        }\n\n        this.homeController.initUi(options);\n      }\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.DatasetModel = Backbone.Model.extend({\n\n      initialize: function () {\n        this.on('sync', this.onSync);\n      },\n\n      defaults: {\n        id: '',\n        name: '',\n        description: '',\n        tags: [],\n        arcgis_online_item_url: '',\n        owner: '',\n        url: '',\n        created_at: '',\n        updated_at: '',\n        views: 0,\n        thumbnail_url: ''\n      },\n\n      parse: function (response) {\n        var data = response.data || response;\n        return data;\n      },\n\n      url: function () {\n        return MyOD.config.api + 'datasets/' + this.get('id') + '.json';\n      },\n\n      getNumericFields: function () {\n        var fields = this.get('fields');\n        return _.filter(fields, function (item) {\n          return _.contains([ 'esriFieldTypeSingle', 'esriFieldTypeDouble', 'esriFieldTypeInteger' ], item.type);\n        });\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.DatasetCollection = Backbone.Collection.extend({\n\n      model: Models.DatasetModel,\n\n      url: function () {\n        return App.searchModel.getUrl(true);\n      },\n\n      parse: function (resp) {\n        App.searchModel.set(_.extend(resp.metadata.query_parameters, resp.metadata.stats));\n        return resp.data;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n\n    ResultsModule.ItemView = Marionette.ItemView.extend({ \n\n      template: JST['results/templates/results-item'],\n\n      model: MyOD.Models.DatasetModel,\n\n      tagName: 'tr',\n\n      events: {\n        click: 'onClick'\n      },\n\n      onClick: function () {\n        this.trigger('result:clicked', this.model);\n      }\n\n    });\n\n    ResultsModule.LoadingView = Marionette.ItemView.extend({ \n\n      template: JST['results/templates/results-loading'],\n\n      tagName: 'tr',\n\n      className: 'loading'\n\n    });\n\n    ResultsModule.EmptyView = Marionette.ItemView.extend({ \n\n      template: JST['results/templates/results-empty'],\n\n      tagName: 'tr'\n\n    });\n\n    ResultsModule.View = Marionette.CompositeView.extend({ \n\n      initialize: function () {\n        this.listenTo(this, 'childview:result:clicked', this.selectDataset);\n      },\n\n      collectionIsLoading: true,\n\n      template: JST['results/templates/results'],\n\n      childView: ResultsModule.ItemView,\n\n      childViewContainer: 'tbody',\n\n      getEmptyView: function () {\n        if (this.collectionIsLoading) {\n          return ResultsModule.LoadingView;\n        } else {\n          return ResultsModule.EmptyView;\n        }\n      },\n\n      events: {\n        'click ul.pagination a': 'onPageClicked'\n      },\n\n      modelEvents: {\n        'change:total_count': 'render'\n      },\n\n      collectionEvents: {\n        'sync': 'onCollectionSync',\n        'error': 'onCollectionSync'\n      },\n\n      id: 'page-results',\n\n      onCollectionSync: function () {\n        this.collectionIsLoading = false;\n        this.render();\n      },\n\n      selectDataset: function (childView, childModel) {\n        App.navigate('/datasets/' + childModel.get('id'), { trigger: true });\n      },\n\n      onPageClicked: function (e) {\n        //allow cmd-click to open in new window\n        if(!(e.metaKey || e.ctrlKey)){\n          e.stopPropagation();\n          e.preventDefault();\n          var page = $(e.target).closest('a').data('page');\n          //not sure why i was doing it this way...\n          //var model = App.searchModel.clone();\n          //App.navigate(model.getRoute(false), { trigger: true });\n          this.model.set('page', page);\n          App.search();\n        }\n      },\n\n      templateHelpers: function () {\n        //serialize the model into what we need for the template\n        var info = App.searchModel.toJSON();\n\n        var len = Math.round(info.total_count);\n        var page = +info.page;\n        var from = (page === 0) ? page + 1 : page;\n        var size = info.per_page;\n        var total_pages = Math.ceil(len / size);\n        var pages = [];\n        \n        //don't show more than 10?\n        var start = ( total_pages > 10 && from > 6 ) ? from - 5 : 1;\n        var end = ( total_pages > start + 9 ) ? start + 9 : total_pages;\n\n        // build the pages array\n        var searchModel = this.model.clone();\n        var active;\n        for (var i = start; i <= end; i++) {\n          active = (i === from) ? 'active' : '';\n          searchModel.set('page', i);\n          pages.push({ url: searchModel.getRoute(false), page: i, active: active });\n        }\n\n        var prevUrl = this.model.getRoute(false);\n        var prevPage = page;\n        if (from !== 1) { \n          prevPage = page-1;\n          searchModel.set('page', prevPage);\n          prevUrl = searchModel.getUrl();\n        }\n        var nextUrl = this.model.getRoute(false);\n        var nextPage = page;\n        if (total_pages !== from) {\n          nextPage = page + 1;\n          searchModel.set('page', nextPage);\n          nextUrl = searchModel.getUrl();\n        }\n\n        return {\n          firstPage: (from === 1) ? 'disabled' : '',\n          lastPage: (total_pages === from) ? 'disabled' : '',\n          prevUrl: prevUrl,\n          nextUrl: nextUrl,\n          prevPage: prevPage,\n          nextPage: nextPage,\n          pages: pages,\n          collectionIsLoading: this.collectionIsLoading\n        };\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n          \n    ResultsModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function (options) {\n        this.collection = new App.Models.DatasetCollection();\n        this.collection.fetch({ cache: true });\n        this.view = new ResultsModule.View({ model: App.searchModel, collection: this.collection });\n        App.layout.getRegion('main').show(this.view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    ResultsModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        'datasets(/)': 'show'\n      }\n    });\n\n    //Add the router during the initialization \n    ResultsModule.addInitializer(function (options) {\n      var router = new ResultsModule.Router({ controller: ResultsModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    ResultsModule.API = {\n\n      show: function(options){\n\n        var queryObj = App.queryStringToObject();\n        //don't encode the q\n        // var q = App.searchModel.get('q');\n        // App.searchModel.set(_.extend(queryObj, { q: q }));\n        App.searchModel.set(queryObj);\n\n        if(!this.resultsController){\n          this.resultsController = new ResultsModule.Controller(options);\n        }\n\n        this.resultsController.initUi(options);\n      }\n\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.DatasetRow = Backbone.Model.extend({\n\n      \n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.RowCollection = Backbone.Collection.extend({\n\n      initialize: function (attributes, options) {\n        this.dataset = options.dataset;\n        \n        var queryCapabilities = this.dataset.get('advanced_query_capabilities');\n        this.supportsPagination = queryCapabilities && queryCapabilities.supports_pagination;\n\n        this.orderBy = this.dataset.get('object_id_field');\n      },\n\n      perPage: 10,\n\n      page: 0,\n\n      orderBy: '',\n\n      orderByAsc: true,\n\n      model: Models.DatasetRow,\n\n      getQueryUrl: function () {\n        var url = this.dataset.get('url');\n        url += '/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&f=pjson';\n\n        if (this.supportsPagination) {\n          url += '&resultOffset=' + this.page * this.perPage;\n          url += '&resultRecordCount=' + this.perPage;\n          //NOTE: when you pass in one of the above two parameters and orderByFields is left empty, \n          //map service uses the object-id field to sort the result. \n          //For a query layer with a pseudo column as the object-id field (e.g., FID), \n          //you must provide orderByFields; otherwise the query fails\n        }\n\n        var orderBy = this.orderBy;\n        if (!this.orderByAsc) {\n          orderBy += ' desc';\n        }\n        //NOTE: this still could fail \n        //if the oid field has changed since it was harvested by open data\n        //or it is null (which should not happen...)\n        url += '&orderByFields=' + orderBy;\n\n        return url;\n      },\n\n      url: function () {\n        return this.getQueryUrl();\n      },\n\n      parse: function (resp) {\n        // this.fields = resp.fields;\n        // this.fieldAliases = resp.fieldAliases;\n        var rows = resp.features;\n        if (!this.supportsPagination) {\n          //this is slightly crappy but \n          //for datasets that don't support pagination\n          //we just show the first n rows with no pagination\n          //even though we got maxRecordCount rows\n          rows = _.first(rows, this.perPage);\n        }\n        return rows;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n         \n    DatasetsModule.TableRowView = Marionette.ItemView.extend({ \n\n      initialize: function (options) {\n        this.dataset = options.dataset;\n        this.fields = this.dataset.get('fields');\n      },\n\n      template: JST['datasets/templates/table-row'],\n\n      templateHelpers: function () {\n        var self = this;\n        return {\n          fields: self.fields\n        };\n      },\n\n      model: MyOD.Models.DatasetRow,\n\n      tagName: 'tr'\n\n    });\n\n    DatasetsModule.TableView = Marionette.CompositeView.extend({\n\n      initialize: function (options) {\n        this.collection = new App.Models.RowCollection([], { dataset: this.model });\n        this.collection.fetch();\n      },\n\n      events: {\n        'click ul.pagination li a': 'onPageClicked',\n        'click thead th': 'sort'\n      },\n\n      collectionEvents: {\n        //we need the pagination to re-render\n        'reset': 'render'\n      },\n\n      template: JST['datasets/templates/table'],\n\n      childView: DatasetsModule.TableRowView,\n\n      childViewOptions: function () {\n        var dataset = this.model;\n        return {\n          dataset: dataset\n        };\n      },\n\n      templateHelpers: function () {\n\n        //defaults - this is what will be rendered if the dataset does not support pagination\n        var obj = {\n          firstPage: '',\n          lastPage: '',\n          prevPage: 0,\n          nextPage: 0,\n          pages: [],\n          showPagination: false,\n          from: 1,\n          to: this.collection.perPage,\n          total: this.model.get('record_count'),\n          sortField: this.collection.orderBy,\n          sortClass: this.collection.orderByAsc ? 'sort_asc' : 'sort_desc',\n          sortIconClass: this.collection.orderByAsc ? 'glyphicon-arrow-down' : 'glyphicon-arrow-up',\n        };\n\n        if (this.collection.supportsPagination) {\n          var totalPages = Math.ceil(this.model.get('record_count') / this.collection.perPage);\n          //zero based page index\n          var page = this.collection.page;\n\n          //don't show more than 10 pages in paginator?\n          var start = (totalPages > 10 && page > 6) ? page - 5 : 1;\n          var end = (totalPages > start + 9) ? start + 9 : totalPages;\n\n          var active, pages = [];\n          for (var i = start; i <= end; i++) {\n            active = (i === page + 1) ? 'active' : '';\n            pages.push({ page: i, active: active });\n          }\n\n          var total = this.model.get('record_count');\n          var from = page * this.collection.perPage + 1;\n          var to = page * this.collection.perPage + this.collection.perPage;\n          to = (to <= total) ? to : total;\n\n          obj = {\n            firstPage: (page === 0) ? 'disabled' : '',\n            lastPage: (totalPages === page + 1) ? 'disabled' : '',\n            prevPage: page,\n            nextPage: page + 2,\n            pages: pages,\n            showPagination: true,\n            from: from,\n            to: to,\n            total: total,\n            sortField: this.collection.orderBy,\n            sortClass: this.collection.orderByAsc ? 'sort_asc' : 'sort_desc',\n            sortIconClass: this.collection.orderByAsc ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up',\n          };\n        }\n\n        return obj;\n      },\n\n      childViewContainer: 'tbody',\n\n      onPageClicked: function (e) {\n        var anchor = $(e.target).closest('a');\n        var li = anchor.closest('li');\n        if (!li.hasClass('disabled') && !li.hasClass('active')) {\n          var page = anchor.data('page') - 1;\n          this.collection.page = page;\n          this.collection.fetch({ reset: true });\n        }\n      },\n\n      sort: function (e) {\n        var orderBy = $(e.target).data('fieldName');\n        if (orderBy) {\n          if (orderBy === this.collection.orderBy) {\n            this.collection.orderByAsc = !this.collection.orderByAsc;\n          } else {\n            this.collection.orderByAsc = true;\n          }\n          this.collection.page = 0;\n          this.collection.orderBy = orderBy;\n          this.collection.fetch({ reset: true });\n        }\n      }\n      \n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n          \n    DatasetsModule.View = Marionette.ItemView.extend({\n\n      initialize: function (options) {\n        _.bindAll(this, 'changeAttribute', 'changeRamp');\n        this.mapManager = options.mapManager;\n      },\n\n      template: JST['datasets/templates/dataset'],\n\n      id: 'page-dataset',\n\n      ui: {\n        'mapDiv': '#map',\n        'tableContainer': '#table-container'\n      },\n\n      modelEvents: {\n        'change': 'render'\n      },\n\n      templateHelpers: function () {\n        var baseUrl = this.model.url().replace(/.json$/, '');\n        return {\n          baseUrl: baseUrl \n        };\n      },\n\n      onRender: function () {\n        //TODO: refactor to use regions...\n        this.tableView = new DatasetsModule.TableView({ el: this.ui.tableContainer, model: this.model }).render();\n      },\n\n      // onShow: function () {\n      //   console.debug('onShow');\n      // },\n\n      onDomRefresh: function () {\n        if (this.model.get('layer_type').toLowerCase() !== 'table') {\n          var self = this;\n          // TODO: would be nice to encapsulate this in mapmanager so consumers wouldn't have to know to do it\n          this.ui.mapDiv.show();\n          this.mapManager.dojoReady.done(function () {\n            self.mapManager.createMap('map', { coords: self.model.get('extent').coordinates });\n            self.mapManager.addDataset(self.model);\n\n            self.initSmaps();\n          });\n        }\n      },\n\n      initSmaps: function (basemap) {\n        var numerics = this.model.getNumericFields();\n\n        if (numerics.length){\n\n          // select the first attr to map \n          // we could put some logic around which to use here\n          this.fieldName = this.fieldName || numerics[0].name;\n          \n          //get stats for selected attribute\n          var fields = this.model.get('fields');\n          this.stats = this.getStats(fields, this.fieldName);\n          this.type = this.getGeometryType(this.model.get('geometry_type'));\n\n\n          var yukiOptions = {\n            fields: numerics,\n            field: this.fieldName,\n            statistics: this.stats,\n            type: this.type,\n            schemes: this.getSchemes()\n          };\n\n          if (!this.yuki) {\n            this.yuki = new Yuki('smaps', yukiOptions);\n          } else {\n            $('#yuki-viz-tools').remove();\n            this.yuki = new Yuki('smaps', yukiOptions);\n          }\n\n          // EVENT Handlers from yuki\n          this.yuki.on('change', this.changeAttribute);\n          this.yuki.on('ramp-change', this.changeRamp);\n\n          this._execStyleMap();\n        }\n\n      },\n\n      getStats: function (fields, fieldName) {\n        var fieldObj = _.findWhere(fields, { name: fieldName });\n        return fieldObj ? fieldObj.statistics : null;\n      },\n\n      getGeometryType: function (geomType) {\n        switch (geomType) {\n          case 'esriGeometryPoint':\n          case 'esriGeometryMultipoint':\n            return 'point';\n          case 'esriGeometryPolyline':\n            return 'line';\n          case 'esriGeometryPolygon':\n            return 'polygon';\n          default:\n            return geomType.toLowerCase();\n        }\n      },\n\n      getSchemes: function (){\n        var theme, styleType, self = this;\n        switch (this.type){\n          case 'point':\n            theme = 'default';\n            styleType = 'size';\n            break;\n          case 'polygon':\n            theme = 'high-to-low';\n            styleType = 'choropleth';\n            break;\n        }\n\n        //TODO: move this into mapmanager\n        return esri.styles[styleType].getSchemes({\n          theme: theme, \n          basemap: 'dark-gray', \n          geometryType: self.type\n        });\n      },\n\n      // handler for attr change \n      changeAttribute: function (fieldName) {\n        //update stats for selected attribute\n        var fields = this.model.get('fields');\n        this.stats = this.getStats(fields, fieldName);\n        this.fieldName = fieldName;\n\n        this._execStyleMap(this.selectedScheme);\n      },\n\n      // handler for ramp UI change\n      changeRamp: function (index) {\n        this.selectedScheme = this.getSchemes().secondarySchemes[index];\n        this._execStyleMap(this.selectedScheme);\n      },\n\n      //update the map in mapmanager\n      _execStyleMap: function (scheme) {\n        var self = this;\n\n        var opts = {\n          field: this.fieldName,\n          basemap: 'dark-gray',\n          statistics: this.stats,\n          type: this.type\n        };\n      \n        if (scheme){\n          opts.scheme = scheme;\n        }\n        \n        var foo = App.reqres.request('smaps:update:style', opts)\n          .done(function(renderer){\n            if (self.type === 'point'){\n              self.yuki.buildPointLegend(renderer.breaks);\n            }\n          });\n      },\n\n      onDestroy: function () {\n        this.mapManager.destroy();\n        this.tableView.destroy();\n      }\n      \n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n\n    DatasetsModule.Controller = Marionette.Controller.extend({ \n\n      initialize: function () {\n        _.bindAll(this, 'onModelFetched');\n      },\n\n      initUi: function (options) {\n        this.mapManager = new App.Utils.MapManager();\n        this.model = new App.Models.DatasetModel({ id: options });\n        this.model\n          .fetch()\n            .done(this.onModelFetched)\n            .fail(function () {\n              App.navigate404();\n            });\n      },\n\n      onModelFetched: function () {\n        var view = new DatasetsModule.View({ model: this.model, mapManager: this.mapManager });\n        App.layout.getRegion('main').show(view);\n      },\n\n      onBeforeDestroy: function () {\n        if (this.mapManager) {\n          this.mapManager.destroy();\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    DatasetsModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        'datasets/:id(/)': 'show',\n      }\n    });\n\n    //Add the router during the initialization \n    DatasetsModule.addInitializer(function (options) {\n      var router = new DatasetsModule.Router({ controller: DatasetsModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    DatasetsModule.API = {\n\n      show: function(options){\n\n        if(!this.datasetsController){\n          this.datasetsController = new DatasetsModule.Controller(options);\n        }\n\n        this.datasetsController.initUi(options);\n      }\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n          \n    ErrorModule.View = Marionette.ItemView.extend({\n      \n      id: 'page-error',\n\n      getTemplate: function(){\n        var errorCode = this.model.get('errorCode');\n        var template;\n\n        switch (errorCode) {\n          case 404:\n              template = JST['error/templates/404'];\n            break;\n          default:\n              template = JST['error/templates/500'];\n        }\n\n        return template;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n\n    ErrorModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function (options) {\n        // init the results view in here so it re-binds on \"back button\"\n        var model = new Backbone.Model({ errorCode: options.errorCode });\n        var view = new ErrorModule.View({ model: model });\n\n        App.layout.getRegion('main').show(view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    ErrorModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        '404': 'error404',\n        '500': 'error500'\n      }\n    });\n\n    //Add the router during the initialization \n    ErrorModule.addInitializer(function (options) {\n      var router = new ErrorModule.Router({ controller: ErrorModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    ErrorModule.API = {\n\n      initController: function () {\n        if(!this.errorController){\n          this.errorController = new ErrorModule.Controller();\n        }\n      },\n\n      error404: function () {\n        this.initController();\n        this.errorController.initUi({ errorCode: 404 });\n      },\n\n      error500: function () {\n        this.initController();\n        this.errorController.initUi({ errorCode: 500 });\n      }\n    };\n\n  });\n})();\n\n$(function () {\n  'use strict';\n\n  MyOD.start();\n});"],"sourceRoot":"/source/"}