{"version":3,"sources":["scripts/main.js"],"names":["this","MyOD","Backbone","Marionette","Application","on","searchModel","Models","SearchModel","layout","Main","Layout","history","start","pushState","root","navigate","trigger","setClasses","route","options","search","getRoute","navigate404","replace","queryStringToObject","result","q","getFragment","split","pairs","_","each","pair","decodeURIComponent","getBloodhound","bloodhound","Bloodhound","datumTokenizer","tokenizers","obj","whitespace","queryTokenizer","limit","remote","url","config","api","rateLimitWait","query","filter","response","data","onBeforeDestroy","stop","module","Utils","App","$","MapManager","Object","extend","initialize","bindAll","globalChannel","Wreqr","radio","channel","dfd","Deferred","dojoReady","promise","require","resolve","reqres","setHandler","updateStyle","map","destroy","proxyEvent","evtName","evt","vent","createMap","mapDiv","mapOpts","center","zoom","basemap","esri","Map","coords","extent","geometry","Extent","SpatialReference","wkid","setExtent","dojo","hitch","getDatasetInfoTemplate","dataset","displayFieldName","get","InfoTemplate","getDatasetLayerOpts","mode","layers","FeatureLayer","MODE_AUTO","outFields","infoTemplate","addDataset","opts","datasetLayer","onLoadDataset","addLayer","layer","minScale","maxScale","_applyRenderer","smap","setRenderer","renderer","graphics","length","attributes","field","redraw","refresh","type","smartMapping","createClassedColorRenderer","then","heatmap","createHeatmapRenderer","createClassedSizeRenderer","Base","SearchView","ItemView","onRender","initTypeahead","highlight","minLength","hint","datasets","name","displayKey","item","templates","empty","source","ttAdapter","ui","typeahead","onTypeaheadSelected","model","set","page","updateModel","onKeyDown","e","which","preventDefault","onKeyUp","Model","defaults","per_page","total_count","sort_by","queryStringParams","pick","toJSON","param","getUrl","JST","datasets/templates/dataset","__t","__p","escape","moment","created_at","calendar","updated_at","tags","join","datasets/templates/table-row","Array","prototype","fields","datasets/templates/table","from","toLocaleString","to","total","sortField","alias","pages","error/templates/404","error/templates/500","home/templates/home","results/templates/results-empty","results/templates/results-item","fromNow","results/templates/results-loading","results/templates/results","collectionIsLoading","HeaderSearchView","listenTo","onQueryChanged","el","template","events","keydown #header-search","keyup #header-search","click #header-search-btn","typeahead:selected input","LayoutView","headerSearchView","render","regions","main","click #home-link","navigateHome","metaKey","ctrlKey","self","indexOf","$el","removeClass","addClass","HomeModule","View","keydown #search","keyup #search","click #search-btn","id","onDomRefresh","focus","Controller","initUi","view","getRegion","show","Router","AppRouter","appRoutes","addInitializer","controller","API","homeController","DatasetModel","onSync","description","arcgis_online_item_url","owner","views","thumbnail_url","parse","getNumericFields","contains","DatasetCollection","Collection","resp","metadata","query_parameters","stats","ResultsModule","tagName","click","onClick","LoadingView","className","EmptyView","CompositeView","selectDataset","childView","childViewContainer","getEmptyView","click ul.pagination a","modelEvents","change:total_count","collectionEvents","sync","error","onCollectionSync","childModel","onPageClicked","stopPropagation","target","closest","templateHelpers","active","info","len","Math","round","size","total_pages","ceil","end","clone","i","push","prevUrl","prevPage","nextUrl","nextPage","firstPage","lastPage","collection","fetch","cache","datasets(/)","queryObj","resultsController","DatasetRow","RowCollection","queryCapabilities","supportsPagination","isUndefined","supports_pagination","window","alert","orderBy","perPage","orderByAsc","getQueryUrl","rows","features","first","DatasetsModule","TableRowView","TableView","click ul.pagination li a","click thead th","reset","childViewOptions","showPagination","sortClass","sortIconClass","totalPages","anchor","li","hasClass","sort","mapManager","tableContainer","change","baseUrl","tableView","toLowerCase","done","coordinates","initSmaps","numerics","fieldName","getStats","getGeometryType","yukiOptions","statistics","schemes","getSchemes","yuki","remove","Yuki","changeAttribute","changeRamp","_execStyleMap","fieldObj","findWhere","geomType","theme","styleType","styles","geometryType","selectedScheme","index","secondarySchemes","scheme","request","buildPointLegend","breaks","onDestroy","onModelFetched","fail","datasets/:id(/)","datasetsController","ErrorModule","getTemplate","errorCode","404","500","initController","errorController","error404","error500"],"mappings":"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","file":"scripts/main.js","sourcesContent":["/*jshint -W020 */\n\nif (!this.MyOD || typeof this.MyOD !== 'object') {\n  this.MyOD = {};\n}\n\n(function () {\n  'use strict';\n\n  MyOD = new Backbone.Marionette.Application();\n\n  MyOD.on('before:start', function(options){\n    this.searchModel = new MyOD.Models.SearchModel();\n    this.layout = new MyOD.Main.Layout();\n    //this.reqres = new Backbone.Wreqr.RequestResponse();\n  });\n\n  MyOD.on('start', function(options){\n    if (Backbone.history){\n      //if you are hosting on a server that can let the browser handle all the routing,\n      //you can use pushstate, otherwise (gh-pages) use hashed urls\n      //Backbone.history.start({ pushState: Modernizr.history, root: '/OpenData-Backbone' });\n      if (!Backbone.history.start({ pushState: false, root: '/OpenData-Backbone' })) {\n        MyOD.navigate('404', { trigger:true });\n      }\n    }\n\n    Backbone.history.on('route', this.layout.setClasses);\n    this.layout.setClasses();\n  });\n\n  MyOD.navigate = function (route, options) {\n    Backbone.history.navigate(route, options);\n  };\n\n  MyOD.search = function (options) {\n    var route = MyOD.searchModel.getRoute();\n    MyOD.navigate(route, { trigger:true });\n  };\n\n  MyOD.navigate404 = function () {\n    MyOD.navigate('404', { trigger: true, replace: true });\n  };\n\n  MyOD.queryStringToObject = function () {\n    var result = {};\n\n    var q = Backbone.history.getFragment().split('?')[1];\n\n    if (q) {\n      var pairs = q.split('&');\n      \n      _.each(pairs, function(pair) {\n        pair = pair.split('=');\n        if (pair[0] === 'q') {\n          result[pair[0]] = pair[1].replace(/\\+/g, ' ') || '';\n        } else {\n          result[pair[0]] = decodeURIComponent(pair[1] || '');\n        }\n      });\n    }\n\n    return result;\n  };\n\n  MyOD.getBloodhound = function () {\n    if (!this.bloodhound) {\n      this.bloodhound = new Bloodhound({\n        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\n        queryTokenizer: Bloodhound.tokenizers.whitespace,\n        limit: 10,\n        remote: {\n          url: MyOD.config.api + 'datasets/autocomplete.json?query=%QUERY',\n          rateLimitWait: 150,\n          replace: function (url, query) {\n            return url.replace('%QUERY', query);\n          },\n          filter: function(response) {\n            return response.data;\n          }\n        }\n      });\n    }\n    return this.bloodhound;\n  };\n\n  MyOD.onBeforeDestroy = function () {\n    Backbone.history.stop();\n  };\n\n})();\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('Utils', function (Utils, App, Backbone, Marionette, $, _) {\n\n    Utils.MapManager = Marionette.Object.extend({\n      \n      initialize: function () {\n        _.bindAll(this, 'updateStyle');\n\n        this.globalChannel = Backbone.Wreqr.radio.channel('global');\n\n        var dfd = $.Deferred();\n        this.dojoReady = dfd.promise();\n        require(['esri/map', 'esri/layers/FeatureLayer', 'plugins/smartMapping', 'dojo/domReady!'], function(Map) {\n          dfd.resolve();\n        });\n        App.reqres.setHandler('smaps:update:style', this.updateStyle);\n      },\n\n      onBeforeDestroy: function () {\n        if (this.map) {\n          this.map.destroy();\n        }\n      },\n\n      proxyEvent: function (evtName, evt) {\n        this.globalChannel.vent.trigger(evtName, evt);\n        //OR (if everything that will listen has a reference to this)\n        //this.trigger(evtName, evt);\n      },\n\n      createMap: function (mapDiv, options) {\n        var mapOpts = {\n          center: [ -56.049, 38.485 ],\n          zoom: 3,\n          basemap: 'dark-gray'\n        };\n\n        this.map = new esri.Map(mapDiv, mapOpts);\n\n        if (options.coords) {\n          var extent = new esri.geometry.Extent(options.coords[0][0], options.coords[0][1], options.coords[1][0], options.coords[1][1], new esri.SpatialReference({ wkid: 4326 }));\n          this.map.setExtent(extent);\n        }\n\n        //proxy events\n        this.map.on('load', dojo.hitch(this, this.proxyEvent, 'map:load'));\n        this.map.on('extent-change', dojo.hitch(this, this.proxyEvent, 'map:extent-change'));\n        this.map.on('layer-add', dojo.hitch(this, this.proxyEvent, 'map:layer-add'));\n      },\n\n      getDatasetInfoTemplate: function (dataset) {\n        //var datasetName = dataset.get('name');\n        var displayFieldName = dataset.get('display_field');\n        return new esri.InfoTemplate('${' + displayFieldName + '}', '${*}');\n      },\n\n      getDatasetLayerOpts: function (dataset) {\n        return { \n          mode: esri.layers.FeatureLayer.MODE_AUTO,\n          outFields: '*',\n          infoTemplate: this.getDatasetInfoTemplate(dataset)\n        };\n      },\n\n      addDataset: function (dataset) {\n        var opts = this.getDatasetLayerOpts(dataset);\n        this.datasetLayer = new esri.layers.FeatureLayer(dataset.get('url'), opts);\n\n        this.datasetLayer.on('load', this.onLoadDataset);\n\n        //proxy events\n        this.datasetLayer.on('load', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:load'));\n        this.datasetLayer.on('click', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:click'));\n        this.datasetLayer.on('query-limit-exceeded', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:query-limit-exceeded'));\n        this.datasetLayer.on('update-end', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:update-end'));\n\n        this.map.addLayer(this.datasetLayer);\n      },\n\n      onLoadDataset: function (evt) {\n        //squash scale ranges - we need the layer to draw at all scales\n        evt.layer.minScale = 0; \n        evt.layer.maxScale = 0;\n      },\n\n      updateStyle: function (opts) {\n        var dfd = $.Deferred();\n\n        var layer = opts.layer = this.datasetLayer;\n\n        var _applyRenderer = function(smap){\n          layer.setRenderer(smap.renderer);\n\n          //check if refresh needed, else redraw\n          if ( layer.graphics && layer.graphics.length ) {\n            if (layer.graphics[0].attributes[ opts.field ]) {\n              layer.redraw();\n            } else {\n              layer.refresh();\n            }\n          }\n\n          dfd.resolve(smap.renderer);\n        };\n\n          \n        if (opts.type === 'polygon'){\n          esri.renderer.smartMapping.createClassedColorRenderer(opts)\n            .then(function(renderer){\n              _applyRenderer( renderer );\n            });\n        } else if (opts.type === 'point' && !opts.heatmap){\n          esri.renderer.smartMapping.createClassedSizeRenderer(opts)\n            .then(function(renderer){\n              _applyRenderer( renderer );\n            });\n        } else if (opts.type === 'point' && opts.heatmap) {\n          esri.renderer.smartMapping.createHeatmapRenderer(opts)\n            .then(function(renderer){\n              _applyRenderer( renderer );\n            });\n        }\n\n        return dfd.promise();\n      }\n      \n    });\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Base', function (Base, App, Backbone, Marionette, $, _) {\n\n    Base.SearchView = Marionette.ItemView.extend({ \n\n      onRender: function(){\n        this.initTypeahead();\n      },\n\n      initTypeahead: function () {\n        var self = this;\n\n        var opts = {\n          highlight: true,\n          minLength: 3,\n          hint: false\n        };\n\n        var bloodhound = App.getBloodhound();\n        bloodhound.initialize();\n\n        var datasets = {\n          name: 'datasets',\n          displayKey: function(item) {\n            return item;\n          },\n          templates: {\n            empty: ''\n          },\n          source: bloodhound.ttAdapter()\n        };\n\n        this.ui.search.typeahead(opts, datasets);\n      },\n\n      onTypeaheadSelected: function (e) {\n        //clicking a selection with the mouse should initiate a search  \n        this.model.set({\n          q: this.ui.search.typeahead('val'),\n          page: 1\n        });\n\n        this.search();\n      },\n\n      updateModel: function () {\n        var q = this.ui.search.typeahead('val');\n        this.model.set({\n          q: q,\n          page: 1\n        });\n      },\n\n      onKeyDown:function(e){\n        if (e.which === 13) {\n          e.preventDefault();\n\n          this.updateModel();\n\n          this.search();\n        }\n      },\n\n      onKeyUp: function () {\n        this.updateModel();\n      },\n\n      search: function () {\n        App.search();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.SearchModel = Backbone.Model.extend({ \n\n      defaults: {\n        q: '',\n        page: 1,\n        per_page: 20,\n        total_count: 0,\n        sort_by: 'relevance'\n      },\n\n      queryStringParams: [ 'q', 'page', 'per_page', 'sort_by' ],\n\n      getRoute: function (api) {\n        var obj = _.pick(this.toJSON(), this.queryStringParams);\n        var route = 'datasets';\n        route += (api) ? '.json?' : '?';\n        route += $.param(obj);\n        return route;\n      },\n\n      getUrl: function () {\n        return App.config.api + this.getRoute(true);\n      }\n\n    });\n\n  });\n\n})();\n\nMyOD.config = {\n  //api: '//umb.dcdev.opendata.arcgis.com/'\n  //api: '//data3.dc.opendataqa.arcgis.com/'\n  //api: '//umb.dcdev.staging.datacommunity.io/'\n  api: '//opendata.arcgis.com/'\n};\nthis.JST = {\"datasets/templates/dataset\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"clearfix\">\\n  <h2 class=\"pull-left clearfix\"><img class=\"img-thumbnail\" src=\"' +\n((__t = ( thumbnail_url )) == null ? '' : __t) +\n'\"><span>' +\n((__t = ( name )) == null ? '' : __t) +\n'</span></h2>\\n  <div class=\"dropdown pull-right\">\\n    <button class=\"btn btn-primary\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\\n      Download\\n      <span class=\"caret\"></span>\\n    </button>\\n    <ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.csv\" target=\"_blank\" download>Spreadsheet</a></li>\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.kml\" target=\"_blank\" download>KML</a></li>\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.zip\" target=\"_blank\" download>Shapefile</a></li>\\n      <li class=\"divider\"></li>\\n      <li><a href=\"' +\n((__t = ( arcgis_online_item_url )) == null ? '' : __t) +\n'\" target=\"_blank\">View in ArcGIS Online</a></li>\\n      <li><a href=\"' +\n((__t = ( url )) == null ? '' : __t) +\n'\" target=\"_blank\">API</a></li>\\n    </ul>\\n  </div>\\n</div>\\n\\n\\n<dl class=\"dl-horizontal\">\\n  \\n  <dt>Description:</dt>\\n  <dd>' +\n((__t = ( description )) == null ? '' : __t) +\n'</dd>\\n  \\n  <dt>Owner:</dt>\\n  <dd>' +\n((__t = ( owner )) == null ? '' : __t) +\n'</dd>\\n\\n  <dt>Created:</dt>\\n  <dd>' +\n((__t = ( moment(created_at).calendar() )) == null ? '' : __t) +\n'</dd>\\n  \\n  <dt>Updated:</dt>\\n  <dd>' +\n((__t = ( moment(updated_at).calendar() )) == null ? '' : __t) +\n'</dd>\\n\\n  <dt>Tags:</dt>\\n  <dd>' +\n((__t = ( tags.join(' | ') )) == null ? '' : __t) +\n'</dd>\\n  \\n  <dt>Views:</dt>\\n  <dd>' +\n((__t = ( views )) == null ? '' : __t) +\n'</dd>\\n\\n</dl>\\n\\n<div class=\"container\">\\n  <div id=\"map\"></div>\\n  <div id=\"smaps\">\\n    <div class=\"container\"></div>\\n  </div>\\n</div>\\n\\n<div id=\"table-container\" class=\"container\"></div>\\n';\n\n}\nreturn __p\n},\n\"datasets/templates/table-row\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n\n _.each(fields, function (field) { ;\n__p += '\\n  <td>' +\n((__t = ( attributes[field.name] )) == null ? '' : __t) +\n'</td>\\n';\n }); ;\n__p += '\\n';\n\n}\nreturn __p\n},\n\"datasets/templates/table\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h4>Showing ' +\n((__t = ( from.toLocaleString() )) == null ? '' : __t) +\n' to ' +\n((__t = ( to.toLocaleString() )) == null ? '' : __t) +\n' of ' +\n((__t = ( total.toLocaleString() )) == null ? '' : __t) +\n'</h4>\\n<div class=\"table-responsive\">  \\n  <table class=\"table table-striped table-bordered table-hover\">\\n    <thead>\\n      <tr>\\n        ';\n _.each(fields, function (field) { ;\n__p += '\\n          ';\n if (sortField === field.name) { ;\n__p += '\\n            <th data-field-name=\"' +\n((__t = ( field.name )) == null ? '' : __t) +\n'\" class=\"' +\n((__t = ( sortClass )) == null ? '' : __t) +\n'\">\\n              ' +\n((__t = ( field.alias || field.name )) == null ? '' : __t) +\n'\\n              <span class=\"glyphicon small ' +\n((__t = ( sortIconClass )) == null ? '' : __t) +\n' text-muted\" aria-hidden=\"true\"></span>\\n            </th>\\n          ';\n } else { ;\n__p += '\\n            <th data-field-name=\"' +\n((__t = ( field.name )) == null ? '' : __t) +\n'\">\\n              ' +\n((__t = ( field.alias || field.name )) == null ? '' : __t) +\n'\\n            </th>\\n          ';\n } ;\n__p += '\\n        ';\n }); ;\n__p += '\\n      </tr>\\n    </thead>\\n    <tbody></tbody>\\n  </table>\\n</div>\\n<nav>\\n  <ul class=\"pagination\">\\n    ';\n if (pages.length > 1) { ;\n__p += '\\n      <li id=\"page-prev\" class=\"' +\n((__t = ( firstPage )) == null ? '' : __t) +\n'\"><a data-page=\"' +\n((__t = ( prevPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&laquo;</span></a></li>\\n      \\n      ';\n _.each(pages, function (page) { ;\n__p += '\\n        <li class=\"' +\n((__t = ( page.active )) == null ? '' : __t) +\n'\"><a class=\"page-number\" data-page=\"' +\n((__t = ( page.page )) == null ? '' : __t) +\n'\">' +\n((__t = ( page.page )) == null ? '' : __t) +\n'</a></li>\\n      ';\n }); ;\n__p += '\\n\\n      <li id=\"page-next\" class=\"' +\n((__t = ( lastPage )) == null ? '' : __t) +\n'\"><a data-page=\"' +\n((__t = ( nextPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&raquo;</span></a></li>\\n    ';\n } ;\n__p += '\\n  </ul>\\n</nav>';\n\n}\nreturn __p\n},\n\"error/templates/404\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"alert alert-danger\" role=\"alert\">\\n  <h2>The page you are looking for doesn\\'t exist.</h2>\\n</div>\\n';\n\n}\nreturn __p\n},\n\"error/templates/500\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"alert alert-danger\" role=\"alert\">\\n  <h2>An error ocurred.</h2>\\n</div>\\n';\n\n}\nreturn __p\n},\n\"home/templates/home\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"jumbotron\" id=\"hero\">\\n  <h1 class=\"page-header\">My Open Data</h1>\\n\\n\\n  <p>\\n    <div class=\"input-group input-group-lg\">\\n      <label class=\"sr-only\" for=\"search\">Search</label>\\n      <input type=\"search\" name=\"search\" id=\"search\" class=\"form-control\" placeholder=\"search for open data\">\\n      <span class=\"input-group-btn\">\\n        <button id=\"search-btn\" class=\"btn btn-default\" type=\"button\">\\n          <span class=\"glyphicon glyphicon-search\" aria-hidden=\"true\"></span>\\n        </button>\\n      </span>\\n    </div>\\n  </p>\\n\\n</div>\\n';\n\n}\nreturn __p\n},\n\"results/templates/results-empty\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td colspan=\"7\" class=\"text-center\">...</td>';\n\n}\nreturn __p\n},\n\"results/templates/results-item\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td>' +\n((__t = ( name )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( owner )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( record_count )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( layer_type )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( views )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( moment(created_at).fromNow() )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( moment(updated_at).fromNow() )) == null ? '' : __t) +\n'</td>';\n\n}\nreturn __p\n},\n\"results/templates/results-loading\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td colspan=\"7\" class=\"text-center\">\\n  <div class=\"progress\">\\n    <div class=\"progress-bar progress-bar-striped active\" role=\"progressbar\" aria-valuenow=\"40\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 45%\">\\n      <span class=\"sr-only\">45% Complete</span>\\n    </div>\\n  </div>\\n</td>';\n\n}\nreturn __p\n},\n\"results/templates/results\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n  ';\n if (!collectionIsLoading) { ;\n__p += '\\n    Your search for <em>\"' +\n((__t = ( q )) == null ? '' : __t) +\n'\"</em> yielded ' +\n((__t = ( total_count.toLocaleString() )) == null ? '' : __t) +\n' datasets\\n  ';\n } ;\n__p += '\\n</h2>\\n\\n<div class=\"table-responsive\">  \\n  <table class=\"table table-striped table-bordered table-hover\">\\n    <thead>\\n      <tr>\\n        <th>NAME</th>\\n        <th>OWNER</th>\\n        <th>RECORDS</th>\\n        <th>LAYER TYPE</th>\\n        <th>VIEWS</th>\\n        <th>CREATED</th>\\n        <th>UPDATED</th>\\n      </tr>\\n    </thead>\\n    <tbody></tbody>\\n  </table>\\n</div>\\n<nav>\\n  <ul class=\"pagination\">\\n    ';\n if (pages.length > 1) { ;\n__p += '\\n      <li id=\"page-prev\" class=\"' +\n((__t = ( firstPage )) == null ? '' : __t) +\n'\"><a href=\"' +\n((__t = ( prevUrl )) == null ? '' : __t) +\n'\" data-page=\"' +\n((__t = ( prevPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&laquo;</span></a></li>\\n      \\n      ';\n _.each(pages, function (page) { ;\n__p += '\\n        <li class=\"' +\n((__t = ( page.active )) == null ? '' : __t) +\n'\"><a href=\"' +\n((__t = ( page.url )) == null ? '' : __t) +\n'\" class=\"page-number\" data-page=\"' +\n((__t = ( page.page )) == null ? '' : __t) +\n'\">' +\n((__t = ( page.page )) == null ? '' : __t) +\n'</a></li>\\n      ';\n }); ;\n__p += '\\n\\n      <li id=\"page-next\" class=\"' +\n((__t = ( lastPage )) == null ? '' : __t) +\n'\"><a href=\"' +\n((__t = ( nextUrl )) == null ? '' : __t) +\n'\" data-page=\"' +\n((__t = ( nextPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&raquo;</span></a></li>\\n    ';\n } ;\n__p += '\\n  </ul>\\n</nav>';\n\n}\nreturn __p\n}};\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Main', function (Main, App, Backbone, Marionette, $, _) {\n          \n    Main.HeaderSearchView = MyOD.Base.SearchView.extend({ \n\n      initialize: function () {\n        this.listenTo(this.model, 'change:q', this.onQueryChanged);\n      },\n\n      el: '#header-search-container',\n\n      template: false,\n\n      events: {\n        'keydown #header-search': 'onKeyDown',\n        'keyup #header-search': 'onKeyUp',\n        'click #header-search-btn': 'search',\n        'typeahead:selected input': 'onTypeaheadSelected'\n      },\n\n      ui: {\n        search: '#header-search'\n      },\n\n      onQueryChanged: function () {\n        this.ui.search.typeahead('val', this.model.get('q'));\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Main', function (Main, App, Backbone, Marionette, $, _) {\n\n    Main.Layout = Marionette.LayoutView.extend({\n      \n      initialize: function () {\n        _.bindAll(this, 'setClasses');\n        this.headerSearchView = new Main.HeaderSearchView({ model: App.searchModel }).render();\n      },\n\n      el: 'body',\n\n      regions: {\n        main: '#main-region'\n      },\n\n      events: {\n        'click #home-link': 'navigateHome'\n      },\n\n      navigateHome: function (e) {\n        if (!e.metaKey && !e.ctrlKey) {\n          e.preventDefault();\n          App.navigate('', { trigger: true });\n        }\n      },\n\n      setClasses: function () {\n        var self = this;\n        if (Backbone.history.getFragment().indexOf('datasets') === 0) {\n          self.$el.removeClass('page-home');\n        } else {\n          self.$el.addClass('page-home');\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n          \n    HomeModule.View = MyOD.Base.SearchView.extend({ \n\n      initialize: function () {\n        this.model = App.searchModel;   \n      },\n\n      template: JST['home/templates/home'],\n\n      events: {\n        'keydown #search': 'onKeyDown',\n        'keyup #search': 'onKeyUp',\n        'click #search-btn': 'search',\n        'typeahead:selected input': 'onTypeaheadSelected'\n      },\n\n      ui: {\n        search: '#search'\n      },\n\n      id: 'home',\n\n      onDomRefresh: function () {\n        this.ui.search.focus();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n          \n    HomeModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function () {\n        var view = new HomeModule.View();\n        App.layout.getRegion('main').show(view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    HomeModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        '': 'show'\n      }\n    });\n\n    //Add the router during the initialization \n    HomeModule.addInitializer(function (options) {\n      var router = new HomeModule.Router({ controller: HomeModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    HomeModule.API = {\n\n      show: function(options){\n\n        if(!this.homeController){\n          this.homeController = new HomeModule.Controller(options);\n        }\n\n        this.homeController.initUi(options);\n      }\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.DatasetModel = Backbone.Model.extend({\n\n      initialize: function () {\n        this.on('sync', this.onSync);\n      },\n\n      defaults: {\n        id: '',\n        name: '',\n        description: '',\n        tags: [],\n        arcgis_online_item_url: '',\n        owner: '',\n        url: '',\n        created_at: '',\n        updated_at: '',\n        views: 0,\n        thumbnail_url: ''\n      },\n\n      parse: function (response) {\n        var data = response.data || response;\n        return data;\n      },\n\n      url: function () {\n        return MyOD.config.api + 'datasets/' + this.get('id') + '.json';\n      },\n\n      getNumericFields: function () {\n        var fields = this.get('fields');\n        return _.filter(fields, function (item) {\n          return _.contains([ 'esriFieldTypeSingle', 'esriFieldTypeDouble', 'esriFieldTypeInteger' ], item.type);\n        });\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.DatasetCollection = Backbone.Collection.extend({\n\n      model: Models.DatasetModel,\n\n      url: function () {\n        return App.searchModel.getUrl(true);\n      },\n\n      parse: function (resp) {\n        App.searchModel.set(_.extend(resp.metadata.query_parameters, resp.metadata.stats));\n        return resp.data;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n\n    ResultsModule.ItemView = Marionette.ItemView.extend({ \n\n      template: JST['results/templates/results-item'],\n\n      model: MyOD.Models.DatasetModel,\n\n      tagName: 'tr',\n\n      events: {\n        click: 'onClick'\n      },\n\n      onClick: function () {\n        this.trigger('result:clicked', this.model);\n      }\n\n    });\n\n    ResultsModule.LoadingView = Marionette.ItemView.extend({ \n\n      template: JST['results/templates/results-loading'],\n\n      tagName: 'tr',\n\n      className: 'loading'\n\n    });\n\n    ResultsModule.EmptyView = Marionette.ItemView.extend({ \n\n      template: JST['results/templates/results-empty'],\n\n      tagName: 'tr'\n\n    });\n\n    ResultsModule.View = Marionette.CompositeView.extend({ \n\n      initialize: function () {\n        this.listenTo(this, 'childview:result:clicked', this.selectDataset);\n      },\n\n      collectionIsLoading: true,\n\n      template: JST['results/templates/results'],\n\n      childView: ResultsModule.ItemView,\n\n      childViewContainer: 'tbody',\n\n      getEmptyView: function () {\n        if (this.collectionIsLoading) {\n          return ResultsModule.LoadingView;\n        } else {\n          return ResultsModule.EmptyView;\n        }\n      },\n\n      events: {\n        'click ul.pagination a': 'onPageClicked'\n      },\n\n      modelEvents: {\n        'change:total_count': 'render'\n      },\n\n      collectionEvents: {\n        'sync': 'onCollectionSync',\n        'error': 'onCollectionSync'\n      },\n\n      id: 'page-results',\n\n      onCollectionSync: function () {\n        this.collectionIsLoading = false;\n        this.render();\n      },\n\n      selectDataset: function (childView, childModel) {\n        App.navigate('/datasets/' + childModel.get('id'), { trigger: true });\n      },\n\n      onPageClicked: function (e) {\n        //allow cmd-click to open in new window\n        if(!(e.metaKey || e.ctrlKey)){\n          e.stopPropagation();\n          e.preventDefault();\n          var page = $(e.target).closest('a').data('page');\n          //not sure why i was doing it this way...\n          //var model = App.searchModel.clone();\n          //App.navigate(model.getRoute(false), { trigger: true });\n          this.model.set('page', page);\n          App.search();\n        }\n      },\n\n      templateHelpers: function () {\n        //serialize the model into what we need for the template\n        var info = App.searchModel.toJSON();\n\n        var len = Math.round(info.total_count);\n        var page = +info.page;\n        var from = (page === 0) ? page + 1 : page;\n        var size = info.per_page;\n        var total_pages = Math.ceil(len / size);\n        var pages = [];\n        \n        //don't show more than 10?\n        var start = ( total_pages > 10 && from > 6 ) ? from - 5 : 1;\n        var end = ( total_pages > start + 9 ) ? start + 9 : total_pages;\n\n        // build the pages array\n        var searchModel = this.model.clone();\n        var active;\n        for (var i = start; i <= end; i++) {\n          active = (i === from) ? 'active' : '';\n          searchModel.set('page', i);\n          pages.push({ url: searchModel.getRoute(false), page: i, active: active });\n        }\n\n        var prevUrl = this.model.getRoute(false);\n        var prevPage = page;\n        if (from !== 1) { \n          prevPage = page-1;\n          searchModel.set('page', prevPage);\n          prevUrl = searchModel.getUrl();\n        }\n        var nextUrl = this.model.getRoute(false);\n        var nextPage = page;\n        if (total_pages !== from) {\n          nextPage = page + 1;\n          searchModel.set('page', nextPage);\n          nextUrl = searchModel.getUrl();\n        }\n\n        return {\n          firstPage: (from === 1) ? 'disabled' : '',\n          lastPage: (total_pages === from) ? 'disabled' : '',\n          prevUrl: prevUrl,\n          nextUrl: nextUrl,\n          prevPage: prevPage,\n          nextPage: nextPage,\n          pages: pages,\n          collectionIsLoading: this.collectionIsLoading\n        };\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n          \n    ResultsModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function (options) {\n        this.collection = new App.Models.DatasetCollection();\n        this.collection.fetch({ cache: true });\n        this.view = new ResultsModule.View({ model: App.searchModel, collection: this.collection });\n        App.layout.getRegion('main').show(this.view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    ResultsModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        'datasets(/)': 'show'\n      }\n    });\n\n    //Add the router during the initialization \n    ResultsModule.addInitializer(function (options) {\n      var router = new ResultsModule.Router({ controller: ResultsModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    ResultsModule.API = {\n\n      show: function(options){\n\n        var queryObj = App.queryStringToObject();\n        //don't encode the q\n        // var q = App.searchModel.get('q');\n        // App.searchModel.set(_.extend(queryObj, { q: q }));\n        App.searchModel.set(queryObj);\n\n        if(!this.resultsController){\n          this.resultsController = new ResultsModule.Controller(options);\n        }\n\n        this.resultsController.initUi(options);\n      }\n\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.DatasetRow = Backbone.Model.extend({\n\n      \n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    Models.RowCollection = Backbone.Collection.extend({\n\n      initialize: function (attributes, options) {\n        this.dataset = options.dataset;\n        \n        var queryCapabilities = this.dataset.get('advanced_query_capabilities');\n        //TODO: this is wrong - it should be supports_pagination but they changed the api!\n        this.supportsPagination = queryCapabilities && queryCapabilities.supportsPagination;\n        \n        if (queryCapabilities && !_.isUndefined(queryCapabilities.supports_pagination)) { \n          window.alert('The API has been fixed. Time to update /entities/row-collection.js!');\n        }\n\n        this.orderBy = this.dataset.get('object_id_field');\n      },\n\n      perPage: 10,\n\n      page: 0,\n\n      orderBy: '',\n\n      orderByAsc: true,\n\n      model: Models.DatasetRow,\n\n      getQueryUrl: function () {\n        var url = this.dataset.get('url');\n        url += '/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&f=pjson';\n\n        if (this.supportsPagination) {\n          url += '&resultOffset=' + this.page * this.perPage;\n          url += '&resultRecordCount=' + this.perPage;\n          //NOTE: when you pass in one of the above two parameters and orderByFields is left empty, \n          //map service uses the object-id field to sort the result. \n          //For a query layer with a pseudo column as the object-id field (e.g., FID), \n          //you must provide orderByFields; otherwise the query fails\n        }\n\n        var orderBy = this.orderBy;\n        if (!this.orderByAsc) {\n          orderBy += ' desc';\n        }\n        //NOTE: this still could fail \n        //if the oid field has changed since it was harvested by open data\n        //or it is null (which should not happen...)\n        url += '&orderByFields=' + orderBy;\n\n        return url;\n      },\n\n      url: function () {\n        return this.getQueryUrl();\n      },\n\n      parse: function (resp) {\n        // this.fields = resp.fields;\n        // this.fieldAliases = resp.fieldAliases;\n        var rows = resp.features;\n        if (!this.supportsPagination) {\n          //this is slightly crappy but \n          //for datasets that don't support pagination\n          //we just show the first n rows with no pagination\n          //even though we got maxRecordCount rows\n          rows = _.first(rows, this.perPage);\n        }\n        return rows;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n         \n    DatasetsModule.TableRowView = Marionette.ItemView.extend({ \n\n      initialize: function (options) {\n        this.dataset = options.dataset;\n        this.fields = this.dataset.get('fields');\n      },\n\n      template: JST['datasets/templates/table-row'],\n\n      templateHelpers: function () {\n        var self = this;\n        return {\n          fields: self.fields\n        };\n      },\n\n      model: MyOD.Models.DatasetRow,\n\n      tagName: 'tr'\n\n    });\n\n    DatasetsModule.TableView = Marionette.CompositeView.extend({\n\n      initialize: function (options) {\n        this.collection = new App.Models.RowCollection([], { dataset: this.model });\n        this.collection.fetch();\n      },\n\n      events: {\n        'click ul.pagination li a': 'onPageClicked',\n        'click thead th': 'sort'\n      },\n\n      collectionEvents: {\n        //we need the pagination to re-render\n        'reset': 'render'\n      },\n\n      template: JST['datasets/templates/table'],\n\n      childView: DatasetsModule.TableRowView,\n\n      childViewOptions: function () {\n        var dataset = this.model;\n        return {\n          dataset: dataset\n        };\n      },\n\n      templateHelpers: function () {\n\n        //defaults - this is what will be rendered if the dataset does not support pagination\n        var obj = {\n          firstPage: '',\n          lastPage: '',\n          prevPage: 0,\n          nextPage: 0,\n          pages: [],\n          showPagination: false,\n          from: 1,\n          to: this.collection.perPage,\n          total: this.model.get('record_count'),\n          sortField: this.collection.orderBy,\n          sortClass: this.collection.orderByAsc ? 'sort_asc' : 'sort_desc',\n          sortIconClass: this.collection.orderByAsc ? 'glyphicon-arrow-down' : 'glyphicon-arrow-up',\n        };\n\n        if (this.collection.supportsPagination) {\n          var totalPages = Math.ceil(this.model.get('record_count') / this.collection.perPage);\n          //zero based page index\n          var page = this.collection.page;\n\n          //don't show more than 10 pages in paginator?\n          var start = (totalPages > 10 && page > 6) ? page - 5 : 1;\n          var end = (totalPages > start + 9) ? start + 9 : totalPages;\n\n          var active, pages = [];\n          for (var i = start; i <= end; i++) {\n            active = (i === page + 1) ? 'active' : '';\n            pages.push({ page: i, active: active });\n          }\n\n          var total = this.model.get('record_count');\n          var from = page * this.collection.perPage + 1;\n          var to = page * this.collection.perPage + this.collection.perPage;\n          to = (to <= total) ? to : total;\n\n          obj = {\n            firstPage: (page === 0) ? 'disabled' : '',\n            lastPage: (totalPages === page + 1) ? 'disabled' : '',\n            prevPage: page,\n            nextPage: page + 2,\n            pages: pages,\n            showPagination: true,\n            from: from,\n            to: to,\n            total: total,\n            sortField: this.collection.orderBy,\n            sortClass: this.collection.orderByAsc ? 'sort_asc' : 'sort_desc',\n            sortIconClass: this.collection.orderByAsc ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up',\n          };\n        }\n\n        return obj;\n      },\n\n      childViewContainer: 'tbody',\n\n      onPageClicked: function (e) {\n        var anchor = $(e.target).closest('a');\n        var li = anchor.closest('li');\n        if (!li.hasClass('disabled') && !li.hasClass('active')) {\n          var page = anchor.data('page') - 1;\n          this.collection.page = page;\n          this.collection.fetch({ reset: true });\n        }\n      },\n\n      sort: function (e) {\n        var orderBy = $(e.target).data('fieldName');\n        if (orderBy) {\n          if (orderBy === this.collection.orderBy) {\n            this.collection.orderByAsc = !this.collection.orderByAsc;\n          } else {\n            this.collection.orderByAsc = true;\n          }\n          this.collection.page = 0;\n          this.collection.orderBy = orderBy;\n          this.collection.fetch({ reset: true });\n        }\n      }\n      \n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n          \n    DatasetsModule.View = Marionette.ItemView.extend({\n\n      initialize: function (options) {\n        _.bindAll(this, 'changeAttribute', 'changeRamp');\n        this.mapManager = options.mapManager;\n      },\n\n      template: JST['datasets/templates/dataset'],\n\n      id: 'page-dataset',\n\n      ui: {\n        'mapDiv': '#map',\n        'tableContainer': '#table-container'\n      },\n\n      modelEvents: {\n        'change': 'render'\n      },\n\n      templateHelpers: function () {\n        var baseUrl = this.model.url().replace(/.json$/, '');\n        return {\n          baseUrl: baseUrl \n        };\n      },\n\n      onRender: function () {\n        //TODO: refactor to use regions...\n        this.tableView = new DatasetsModule.TableView({ el: this.ui.tableContainer, model: this.model }).render();\n      },\n\n      // onShow: function () {\n      //   console.debug('onShow');\n      // },\n\n      onDomRefresh: function () {\n        if (this.model.get('layer_type').toLowerCase() !== 'table') {\n          var self = this;\n          // TODO: would be nice to encapsulate this in mapmanager so consumers wouldn't have to know to do it\n          this.ui.mapDiv.show();\n          this.mapManager.dojoReady.done(function () {\n            self.mapManager.createMap('map', { coords: self.model.get('extent').coordinates });\n            self.mapManager.addDataset(self.model);\n\n            self.initSmaps();\n          });\n        }\n      },\n\n      initSmaps: function (basemap) {\n        var numerics = this.model.getNumericFields();\n\n        if (numerics.length){\n\n          // select the first attr to map \n          // we could put some logic around which to use here\n          this.fieldName = this.fieldName || numerics[0].name;\n          \n          //get stats for selected attribute\n          var fields = this.model.get('fields');\n          this.stats = this.getStats(fields, this.fieldName);\n          this.type = this.getGeometryType(this.model.get('geometry_type'));\n\n\n          var yukiOptions = {\n            fields: numerics,\n            field: this.fieldName,\n            statistics: this.stats,\n            type: this.type,\n            schemes: this.getSchemes()\n          };\n\n          if (!this.yuki) {\n            this.yuki = new Yuki('smaps', yukiOptions);\n          } else {\n            $('#yuki-viz-tools').remove();\n            this.yuki = new Yuki('smaps', yukiOptions);\n          }\n\n          // EVENT Handlers from yuki\n          this.yuki.on('change', this.changeAttribute);\n          this.yuki.on('ramp-change', this.changeRamp);\n\n          this._execStyleMap();\n        }\n\n      },\n\n      getStats: function (fields, fieldName) {\n        var fieldObj = _.findWhere(fields, { name: fieldName });\n        return fieldObj ? fieldObj.statistics : null;\n      },\n\n      getGeometryType: function (geomType) {\n        switch (geomType) {\n          case 'esriGeometryPoint':\n          case 'esriGeometryMultipoint':\n            return 'point';\n          case 'esriGeometryPolyline':\n            return 'line';\n          case 'esriGeometryPolygon':\n            return 'polygon';\n          default:\n            return geomType.toLowerCase();\n        }\n      },\n\n      getSchemes: function (){\n        var theme, styleType, self = this;\n        switch (this.type){\n          case 'point':\n            theme = 'default';\n            styleType = 'size';\n            break;\n          case 'polygon':\n            theme = 'high-to-low';\n            styleType = 'choropleth';\n            break;\n        }\n\n        //TODO: move this into mapmanager\n        return esri.styles[styleType].getSchemes({\n          theme: theme, \n          basemap: 'dark-gray', \n          geometryType: self.type\n        });\n      },\n\n      // handler for attr change \n      changeAttribute: function (fieldName) {\n        //update stats for selected attribute\n        var fields = this.model.get('fields');\n        this.stats = this.getStats(fields, fieldName);\n        this.fieldName = fieldName;\n\n        this._execStyleMap(this.selectedScheme);\n      },\n\n      // handler for ramp UI change\n      changeRamp: function (index) {\n        this.selectedScheme = this.getSchemes().secondarySchemes[index];\n        this._execStyleMap(this.selectedScheme);\n      },\n\n      //update the map in mapmanager\n      _execStyleMap: function (scheme) {\n        var self = this;\n\n        var opts = {\n          field: this.fieldName,\n          basemap: 'dark-gray',\n          statistics: this.stats,\n          type: this.type\n        };\n      \n        if (scheme){\n          opts.scheme = scheme;\n        }\n        \n        var foo = App.reqres.request('smaps:update:style', opts)\n          .done(function(renderer){\n            if (self.type === 'point'){\n              self.yuki.buildPointLegend(renderer.breaks);\n            }\n          });\n      },\n\n      onDestroy: function () {\n        this.mapManager.destroy();\n        this.tableView.destroy();\n      }\n      \n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n\n    DatasetsModule.Controller = Marionette.Controller.extend({ \n\n      initialize: function () {\n        _.bindAll(this, 'onModelFetched');\n      },\n\n      initUi: function (options) {\n        this.mapManager = new App.Utils.MapManager();\n        this.model = new App.Models.DatasetModel({ id: options });\n        this.model\n          .fetch()\n            .done(this.onModelFetched)\n            .fail(function () {\n              App.navigate404();\n            });\n      },\n\n      onModelFetched: function () {\n        var view = new DatasetsModule.View({ model: this.model, mapManager: this.mapManager });\n        App.layout.getRegion('main').show(view);\n      },\n\n      onBeforeDestroy: function () {\n        if (this.mapManager) {\n          this.mapManager.destroy();\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    DatasetsModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        'datasets/:id(/)': 'show',\n      }\n    });\n\n    //Add the router during the initialization \n    DatasetsModule.addInitializer(function (options) {\n      var router = new DatasetsModule.Router({ controller: DatasetsModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    DatasetsModule.API = {\n\n      show: function(options){\n\n        if(!this.datasetsController){\n          this.datasetsController = new DatasetsModule.Controller(options);\n        }\n\n        this.datasetsController.initUi(options);\n      }\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n          \n    ErrorModule.View = Marionette.ItemView.extend({\n      \n      id: 'page-error',\n\n      getTemplate: function(){\n        var errorCode = this.model.get('errorCode');\n        var template;\n\n        switch (errorCode) {\n          case 404:\n              template = JST['error/templates/404'];\n            break;\n          default:\n              template = JST['error/templates/500'];\n        }\n\n        return template;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n\n    ErrorModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function (options) {\n        // init the results view in here so it re-binds on \"back button\"\n        var model = new Backbone.Model({ errorCode: options.errorCode });\n        var view = new ErrorModule.View({ model: model });\n\n        App.layout.getRegion('main').show(view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    ErrorModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        '404': 'error404',\n        '500': 'error500'\n      }\n    });\n\n    //Add the router during the initialization \n    ErrorModule.addInitializer(function (options) {\n      var router = new ErrorModule.Router({ controller: ErrorModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    ErrorModule.API = {\n\n      initController: function () {\n        if(!this.errorController){\n          this.errorController = new ErrorModule.Controller();\n        }\n      },\n\n      error404: function () {\n        this.initController();\n        this.errorController.initUi({ errorCode: 404 });\n      },\n\n      error500: function () {\n        this.initController();\n        this.errorController.initUi({ errorCode: 500 });\n      }\n    };\n\n  });\n})();\n\n$(function () {\n  'use strict';\n\n  MyOD.start();\n});"],"sourceRoot":"/source/"}